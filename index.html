<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¹ãƒãƒ›ç”¨ãƒ”ãƒ³åœ°å›³</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  body {
    margin: 0;
    font-family: sans-serif;
  }

  #map {
    height: 65vh;
  }

  .panel {
    padding: 10px;
    background: #f5f5f5;
  }

  input, textarea, button {
    width: 100%;
    margin-top: 6px;
    font-size: 16px;
  }

  /* ä¸‹ã‹ã‚‰å‡ºã‚‹è©³ç´°ãƒ‘ãƒãƒ« */
  .detail {
    position: fixed;
    bottom: -100%;
    left: 0;
    width: 100%;
    background: white;
    padding: 15px;
    border-top: 2px solid #ccc;
    transition: 0.3s;
    z-index: 1000;
  }

  .detail.show {
    bottom: 0;
  }
</style>
</head>

<body>

<div id="map"></div>

<div class="panel">
  <textarea id="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã"></textarea>
  <input type="file" id="photo">
  <button onclick="addPin()">ãƒ”ãƒ³ã‚’è¿½åŠ </button>
</div>

<div id="detail" class="detail">
  <p id="detailText"></p>
  <button onclick="deleteComment()">ğŸ—‘ ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤</button>
  <button onclick="deletePin()">âŒ ãƒ”ãƒ³å‰Šé™¤</button>
  <button onclick="closeDetail()">é–‰ã˜ã‚‹</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([33.43574, 130.58161], 17);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 20
  }).addTo(map);

  let selectedLatLng = null;
  let currentMarker = null;

  map.on('click', e => {
    selectedLatLng = e.latlng;
    alert("å ´æ‰€ã‚’é¸æŠã—ãŸã‚ˆ");
  });

  function addPin() {
    if (!selectedLatLng) {
      alert("åœ°å›³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å ´æ‰€ã‚’é¸ã‚“ã§ï¼");
      return;
    }

    const comment = document.getElementById("comment").value;
    const photoInput = document.getElementById("photo");

    const marker = L.marker(selectedLatLng).addTo(map);
    marker.comment = comment;
    marker.photo = photoInput.files[0] || null;

    marker.on('click', () => openDetail(marker));

    document.getElementById("comment").value = "";
    document.getElementById("photo").value = "";
    selectedLatLng = null;
  }

  function openDetail(marker) {
    currentMarker = marker;
    let html = `<b>${marker.comment || "ã‚³ãƒ¡ãƒ³ãƒˆãªã—"}</b><br>`;

    if (marker.photo) {
      html += `<img src="${URL.createObjectURL(marker.photo)}" width="100%">`;
    }

    document.getElementById("detailText").innerHTML = html;
    document.getElementById("detail").classList.add("show");
  }

  function closeDetail() {
    document.getElementById("detail").classList.remove("show");
  }

  function deletePin() {
    map.removeLayer(currentMarker);
    closeDetail();
  }

  function deleteComment() {
    currentMarker.comment = "";
    document.getElementById("detailText").innerHTML = "<b>ã‚³ãƒ¡ãƒ³ãƒˆãªã—</b>";
  }
</script>

</body>
</html>
