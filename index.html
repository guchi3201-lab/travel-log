<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ãƒ”ãƒ³ä»˜ãåœ°å›³</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  body {
    margin: 0;
    font-family: sans-serif;
  }

  /* åœ°å›³ã¯å°‘ã—å°ã•ã‚ */
  #map {
    height: 70vh;
    width: 100%;
  }

  .form {
    padding: 10px;
    background: #f5f5f5;
  }

  input, textarea, button {
    width: 100%;
    margin-top: 6px;
    font-size: 16px;
  }
</style>
</head>

<body>

<div id="map"></div>

<div class="form">
  <input type="text" id="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã">
  <input type="file" id="photo">
  <button onclick="addPin()">ã“ã®å ´æ‰€ã«ãƒ”ãƒ³ã‚’è¿½åŠ </button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // åœ°å›³ä½œæˆï¼ˆã‹ãªã‚Šæ‹¡å¤§ã—ãŸçŠ¶æ…‹ï¼‰
  const map = L.map('map').setView(
    [33.30001, 130.51506],
    18   // â† ã“ã“ãŒã‚ºãƒ¼ãƒ å¼·åŒ–ãƒã‚¤ãƒ³ãƒˆï¼ˆ3å›ã‚ºãƒ¼ãƒ ç›¸å½“ï¼‰
  );

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 20
  }).addTo(map);

  let selectedLatLng = null;

  // åœ°å›³ã‚¿ãƒƒãƒ—ã§ä½ç½®é¸æŠ
  map.on('click', function(e) {
    selectedLatLng = e.latlng;
    alert(`ğŸ“ å ´æ‰€ã‚’é¸æŠ\nç·¯åº¦ ${e.latlng.lat.toFixed(5)}\nçµŒåº¦ ${e.latlng.lng.toFixed(5)}`);
  });

  function addPin() {
    if (!selectedLatLng) {
      alert("å…ˆã«åœ°å›³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ï¼");
      return;
    }

    const comment = document.getElementById("comment").value;
    const photoInput = document.getElementById("photo");

    let popupContent = `<b>${comment || "ã‚³ãƒ¡ãƒ³ãƒˆãªã—"}</b><br>`;

    if (photoInput.files.length > 0) {
      const imgURL = URL.createObjectURL(photoInput.files[0]);
      popupContent += `<img src="${imgURL}" width="150"><br>`;
    }

    popupContent += `<button onclick="removePin(this)">ğŸ—‘ ãƒ”ãƒ³å‰Šé™¤</button>`;

    const marker = L.marker(selectedLatLng).addTo(map);
    marker.bindPopup(popupContent);

    marker.on('popupopen', function() {
      window.currentMarker = marker;
    });

    // å…¥åŠ›ãƒªã‚»ãƒƒãƒˆ
    document.getElementById("comment").value = "";
    document.getElementById("photo").value = "";
    selectedLatLng = null;
  }

  function removePin(button) {
    map.removeLayer(window.currentMarker);
  }
</script>

</body>
</html>
