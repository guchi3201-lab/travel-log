<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ãƒã‚¤æ—…è¡Œãƒãƒƒãƒ—</title>

<!-- Leaflet -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
  }

  /* æ¤œç´¢ãƒãƒ¼ */
  #search-bar {
    display: flex;
    padding: 8px;
    border-bottom: 1px solid #ddd;
  }
  #search-input {
    flex: 9;
    padding: 10px;
    font-size: 16px;
  }
  #search-btn {
    flex: 1;
    font-size: 16px;
  }

  /* ãƒ¡ã‚¤ãƒ³ */
  #container {
    display: flex;
    height: calc(100vh - 52px);
  }

  #map {
    width: 60%;
    height: 100%;
  }

  #info {
    width: 40%;
    padding: 10px;
    border-left: 1px solid #ddd;
    overflow-y: auto;
    display: none;
  }

  /* ã‚¹ãƒãƒ› */
  @media (max-width: 768px) {
    #container {
      flex-direction: column;
    }
    #map {
      width: 100%;
      height: 60%;
    }
    #info {
      width: 100%;
      height: 40%;
    }
  }

  .tags label {
    display: inline-block;
    margin-right: 8px;
  }

  img.preview {
    width: 100%;
    margin-top: 5px;
    border-radius: 6px;
  }

  button {
    padding: 8px;
    margin-top: 8px;
  }
</style>
</head>

<body>

<!-- æ¤œç´¢ -->
<div id="search-bar">
  <input id="search-input" placeholder="ä¾‹ï¼šå²¡å±±" />
  <button id="search-btn">ğŸ”</button>
</div>

<!-- ãƒ¡ã‚¤ãƒ³ -->
<div id="container">
  <div id="map"></div>

  <div id="info">
    <h3 id="place-title">ã‚¹ãƒãƒƒãƒˆ</h3>

    <div class="tags">
      <label><input type="checkbox" value="æ¸©æ³‰"> â™¨ æ¸©æ³‰</label>
      <label><input type="checkbox" value="ç¥ç¤¾"> â›© ç¥ç¤¾</label>
      <label><input type="checkbox" value="åŸ"> ğŸ¯ åŸ</label>
      <label><input type="checkbox" value="å±±"> â›° å±±</label>
      <label><input type="checkbox" value="æµ·"> ğŸŒŠ æµ·</label>
      <label><input type="checkbox" value="ã‚°ãƒ«ãƒ¡"> ğŸœ ã‚°ãƒ«ãƒ¡</label>
      <label><input type="checkbox" value="çµ¶æ™¯"> ğŸ“¸ çµ¶æ™¯</label>
    </div>

    <textarea id="comment" rows="3" style="width:100%" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆ"></textarea>

    <input type="file" id="photo" accept="image/*" />
    <img id="photo-preview" class="preview" />

    <button id="save">ğŸ’¾ ä¿å­˜</button>
  </div>
</div>

<script>
  const map = L.map("map").setView([34.665, 133.919], 10);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap",
  }).addTo(map);

  let currentMarker = null;
  let markers = JSON.parse(localStorage.getItem("markers") || "[]");

  const icons = {
    æ¸©æ³‰: "â™¨",
    ç¥ç¤¾: "â›©",
    åŸ: "ğŸ¯",
    å±±: "â›°",
    æµ·: "ğŸŒŠ",
    ã‚°ãƒ«ãƒ¡: "ğŸœ",
    çµ¶æ™¯: "ğŸ“¸",
  };

  function saveMarkers() {
    localStorage.setItem("markers", JSON.stringify(markers));
  }

  function renderMarkers() {
    markers.forEach((m) => {
      const iconText = m.tags.map(t => icons[t]).join("");
      const marker = L.marker([m.lat, m.lng]).addTo(map);
      marker.bindPopup(`
        <strong>${m.name}</strong><br>
        ${iconText}<br>
        ${m.photo ? `<img src="${m.photo}" width="120">` : ""}
      `);

      marker.on("click", () => openInfo(m, marker));
    });
  }

  renderMarkers();

  map.on("click", (e) => {
    const name = prompt("ã‚¹ãƒãƒƒãƒˆå");
    if (!name) return;

    const markerData = {
      name,
      lat: e.latlng.lat,
      lng: e.latlng.lng,
      tags: [],
      comment: "",
      photo: null,
    };
    markers.push(markerData);
    saveMarkers();
    location.reload();
  });

  function openInfo(data, marker) {
    currentMarker = data;
    document.getElementById("info").style.display = "block";
    document.getElementById("place-title").innerText = data.name;
    document.getElementById("comment").value = data.comment || "";

    document.querySelectorAll(".tags input").forEach(cb => {
      cb.checked = data.tags.includes(cb.value);
    });

    if (data.photo) {
      document.getElementById("photo-preview").src = data.photo;
    }
  }

  document.getElementById("photo").addEventListener("change", (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      document.getElementById("photo-preview").src = reader.result;
    };
    reader.readAsDataURL(file);
  });

  document.getElementById("save").onclick = () => {
    currentMarker.comment = document.getElementById("comment").value;
    currentMarker.tags = Array.from(
      document.querySelectorAll(".tags input:checked")
    ).map(cb => cb.value);

    const img = document.getElementById("photo-preview").src;
    currentMarker.photo = img || null;

    saveMarkers();
    alert("ä¿å­˜ã—ã¾ã—ãŸ");
  };

  document.getElementById("search-btn").onclick = () => {
    const q = document.getElementById("search-input").value;
    if (q.includes("å²¡å±±")) {
      map.setView([34.665, 133.919], 8);
    }
  };
</script>

</body>
</html>
