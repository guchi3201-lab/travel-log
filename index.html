<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ—…è¡Œè¨˜éŒ²ãƒãƒƒãƒ—</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body {
  margin: 0;
  font-family: sans-serif;
}

/* æ¤œç´¢ãƒãƒ¼ */
#searchBar {
  height: 5vh;
  display: flex;
  border-bottom: 1px solid #ccc;
}

#searchInput {
  flex: 1;
  border: none;
  padding: 8px;
  font-size: 16px;
}

#searchBtn {
  width: 50px;
  border: none;
  font-size: 20px;
  background: #eee;
}

/* åœ°å›³ */
#map {
  height: 65vh;
}

/* æƒ…å ±æ¬„ */
#info {
  height: 30vh;
  padding: 10px;
  border-top: 1px solid #ccc;
  overflow-y: auto;
}

/* ãƒã‚§ãƒƒã‚¯UI */
.checkGroup label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  border: 1px solid #ccc;
  padding: 4px 6px;
  margin: 3px;
}

/* ãƒ”ãƒ³ */
.pin {
  position: relative;
  width: 26px;
  height: 26px;
  background: red;
  border-radius: 50% 50% 50% 0;
  transform: rotate(-45deg);
}

.pin span {
  position: absolute;
  transform: rotate(45deg);
  top: 5px;
  left: 6px;
  font-size: 14px;
  color: white;
}
</style>
</head>

<body>

<!-- æ¤œç´¢ -->
<div id="searchBar">
  <input id="searchInput" placeholder="å ´æ‰€ã‚’æ¤œç´¢">
  <button id="searchBtn">ğŸ”</button>
</div>

<!-- åœ°å›³ -->
<div id="map"></div>

<!-- æƒ…å ±æ¬„ -->
<div id="info">
  <div>
    å ´æ‰€åï¼š
    <input id="placeName" placeholder="ä¾‹ï¼šé«˜è‰¯å±±">
  </div>

  <div style="margin-top:8px;">
    è©•ä¾¡ï¼š
    <div class="checkGroup" id="rateGroup">
      <label><input type="checkbox" value="1">1</label>
      <label><input type="checkbox" value="2">2</label>
      <label><input type="checkbox" value="3">3</label>
      <label><input type="checkbox" value="4">4</label>
      <label><input type="checkbox" value="5">5</label>
    </div>
  </div>

  <div style="margin-top:8px;">
    ã‚¿ã‚°ï¼š
    <div class="checkGroup">
      <label><input type="checkbox" data-icon="â™¨ï¸">â™¨ï¸ æ¸©æ³‰</label>
      <label><input type="checkbox" data-icon="ğŸœ">ğŸœ ã”é£¯</label>
      <label><input type="checkbox" data-icon="ğŸ">ğŸ è‡ªç„¶</label>
      <label><input type="checkbox" data-icon="ğŸ¯">ğŸ¯ è¦³å…‰</label>
    </div>
  </div>

  <div style="margin-top:10px;">
    <button id="saveBtn">ä¿å­˜</button>
    <button id="deleteBtn">å‰Šé™¤</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const map = L.map('map').setView([33.3,130.5], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let currentMarker = null;
let selectedRate = 1;

/* è©•ä¾¡ãƒã‚§ãƒƒã‚¯ã¯1ã¤ã ã‘ */
document.querySelectorAll('#rateGroup input').forEach(cb => {
  cb.onchange = () => {
    document.querySelectorAll('#rateGroup input').forEach(o => o.checked = false);
    cb.checked = true;
    selectedRate = cb.value;
  };
});

/* è‰²è¨ˆç®— */
function getColor(rate) {
  if(rate == 5) return "linear-gradient(45deg,red,orange,yellow,green,blue)";
  const alpha = rate * 0.2;
  return `rgba(255,0,0,${alpha})`;
}

/* ãƒãƒ¼ã‚«ãƒ¼ç”Ÿæˆ */
function createMarker(latlng, rate, icon) {
  const html = `
    <div class="pin" style="background:${getColor(rate)}">
      <span>${icon}</span>
    </div>`;
  return L.marker(latlng, {
    icon: L.divIcon({ html, className:"", iconSize:[26,26] })
  });
}

/* åœ°å›³ã‚¿ãƒƒãƒ— */
map.on('click', e => {
  if(currentMarker) map.removeLayer(currentMarker);
  currentMarker = createMarker(e.latlng, 1, "ğŸ“").addTo(map);
});

/* ä¿å­˜ */
saveBtn.onclick = () => {
  const icon =
    document.querySelector('input[data-icon]:checked')?.dataset.icon || "ğŸ“";

  map.removeLayer(currentMarker);
  currentMarker = createMarker(
    currentMarker.getLatLng(),
    selectedRate,
    icon
  ).addTo(map);
};

/* å‰Šé™¤ */
deleteBtn.onclick = () => {
  if(currentMarker) map.removeLayer(currentMarker);
};
</script>

</body>
</html>
