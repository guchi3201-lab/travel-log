<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—…è¡Œãƒ­ã‚°ï¼ˆæ—¥æœ¬ï¼‰</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

/* æ¤œç´¢ */
#searchBox {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  background: white;
  padding: 6px;
  border-radius: 8px;
  display: flex;
  gap: 6px;
}

#searchBox input {
  font-size: 16px;
  padding: 4px;
  width: 180px;
}

#searchBox button {
  font-size: 16px;
}

/* åœ°å›³ */
#map {
  height: 65vh;
}

/* ä¸‹ãƒ‘ãƒãƒ« */
#panel {
  height: 35vh;
  border-top: 1px solid #ccc;
  padding: 10px;
}

textarea {
  width: 100%;
  height: 60px;
  font-size: 16px;
}

button {
  width: 100%;
  font-size: 16px;
  margin-top: 6px;
}
</style>
</head>

<body>

<div id="searchBox">
  <input id="searchInput" placeholder="ä¾‹ï¼šå¤ªå®°åºœå¤©æº€å®®">
  <button onclick="searchPlace()">æ¤œç´¢</button>
</div>

<div id="map"></div>

<div id="panel">
  <b id="panelTitle">ğŸ“ ãƒ”ãƒ³ã‚’é¸æŠ</b>
  <textarea id="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã"></textarea>
  <button onclick="markDone()">è¡Œã£ãŸã«ã™ã‚‹</button>
  <button onclick="deletePin()">ãƒ”ãƒ³å‰Šé™¤</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ---------- åœ°å›³ ----------
const map = L.map("map", {
  minZoom: 5,
  maxZoom: 20
}).setView([36.5, 138], 9);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 20
}).addTo(map);

// ---------- ãƒ”ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ ----------
const wantIcon = L.icon({
  iconUrl: "https://maps.gstatic.com/mapfiles/ms2/micons/yellow.png",
  iconSize: [32, 32],
  iconAnchor: [16, 32]
});

const doneIcon = L.icon({
  iconUrl: "https://maps.gstatic.com/mapfiles/ms2/micons/red.png",
  iconSize: [32, 32],
  iconAnchor: [16, 32]
});

// ---------- çŠ¶æ…‹ ----------
let selectedLatLng = null;
let currentMarker = null;

// ---------- åœ°å›³ã‚¿ãƒƒãƒ—ã§ãƒ”ãƒ³ ----------
map.on("click", e => {
  const marker = L.marker(e.latlng, { icon: wantIcon }).addTo(map);
  marker.status = "want";
  marker.comment = "";

  marker.on("click", () => openPanel(marker));
  openPanel(marker);
});

// ---------- ãƒ‘ãƒãƒ« ----------
function openPanel(marker) {
  currentMarker = marker;
  document.getElementById("panelTitle").textContent =
    marker.status === "want" ? "ğŸŸ¡ è¡ŒããŸã„å ´æ‰€" : "ğŸ”´ è¡Œã£ãŸå ´æ‰€";
  document.getElementById("comment").value = marker.comment;
}

document.getElementById("comment").addEventListener("input", e => {
  if (currentMarker) {
    currentMarker.comment = e.target.value;
  }
});

function markDone() {
  if (!currentMarker) return;
  currentMarker.setIcon(doneIcon);
  currentMarker.status = "done";
  openPanel(currentMarker);
}

function deletePin() {
  if (!currentMarker) return;
  map.removeLayer(currentMarker);
  currentMarker = null;
  document.getElementById("comment").value = "";
  document.getElementById("panelTitle").textContent = "ğŸ“ ãƒ”ãƒ³ã‚’é¸æŠ";
}

// ---------- æ¤œç´¢ ----------
function searchPlace() {
  const q = document.getElementById("searchInput").value;
  if (!q) return;

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q + " æ—¥æœ¬")}`)
    .then(r => r.json())
    .then(data => {
      if (data.length === 0) {
        alert("è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
        return;
      }
      map.setView([data[0].lat, data[0].lon], 16);
    });
}
</script>

</body>
</html>
