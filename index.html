<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ—…è¡Œã®è¨˜éŒ²ãƒãƒƒãƒ—</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

#searchBar {
  height: 5vh;
  display: flex;
  border-bottom: 1px solid #ccc;
}

#searchInput {
  flex: 1;
  border: none;
  padding: 8px;
}

#searchBtn {
  width: 50px;
  border: none;
  background: #f0f0f0;
  font-size: 18px;
}

#container {
  display: flex;
  height: 95vh;
}

#map {
  flex: 1;
}

#info {
  width: 320px;
  border-left: 1px solid #ccc;
  padding: 10px;
  overflow-y: auto;
}

label {
  display: block;
  margin-top: 8px;
}

.rating span {
  border: 1px solid #aaa;
  padding: 5px;
  margin-right: 5px;
  cursor: pointer;
}

.rating span.active {
  background: #333;
  color: white;
}

.tags span {
  border: 1px solid #aaa;
  padding: 5px;
  margin: 3px;
  display: inline-block;
  cursor: pointer;
}

.tags span.active {
  background: #555;
  color: white;
}

button {
  margin-top: 10px;
  width: 100%;
}

@media (max-width: 768px) {
  #container {
    flex-direction: column;
  }
  #info {
    width: 100%;
    border-left: none;
    border-top: 1px solid #ccc;
  }
}
</style>
</head>

<body>

<div id="searchBar">
  <input id="searchInput" placeholder="å ´æ‰€æ¤œç´¢" />
  <button id="searchBtn">ğŸ”</button>
</div>

<div id="container">
  <div id="map"></div>

  <div id="info">
    <label>å ´æ‰€å
      <input id="placeName" />
    </label>

    <label>è©•ä¾¡</label>
    <div class="rating" id="rating"></div>

    <label>ã‚¿ã‚°</label>
    <div class="tags" id="tags"></div>

    <label>ã‚³ãƒ¡ãƒ³ãƒˆ
      <textarea id="comment"></textarea>
    </label>

    <label>å†™çœŸï¼ˆæœ€å¤§5æšï¼‰
      <input type="file" id="photos" multiple accept="image/*" />
    </label>

    <button onclick="savePin()">ä¿å­˜</button>
    <button onclick="deletePin()">å‰Šé™¤</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('map').setView([35.6586, 139.7454], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let currentMarker = null;
let selectedRating = 0;
let selectedTags = [];

const tagList = [
  { name: "æ¸©æ³‰", icon: "â™¨ï¸" },
  { name: "ã‚°ãƒ«ãƒ¡", icon: "ğŸ´" },
  { name: "å±±", icon: "â›°" },
  { name: "æµ·", icon: "ğŸŒŠ" },
  { name: "åŸ", icon: "ğŸ¯" },
  { name: "çµ¶æ™¯", icon: "ğŸŒ…" }
];

// rating
const ratingDiv = document.getElementById("rating");
for (let i = 1; i <= 5; i++) {
  const s = document.createElement("span");
  s.textContent = i;
  s.onclick = () => {
    selectedRating = i;
    [...ratingDiv.children].forEach(c => c.classList.remove("active"));
    s.classList.add("active");
  };
  ratingDiv.appendChild(s);
}

// tags
const tagDiv = document.getElementById("tags");
tagList.forEach(t => {
  const s = document.createElement("span");
  s.textContent = `${t.icon} ${t.name}`;
  s.onclick = () => {
    s.classList.toggle("active");
    selectedTags = [...tagDiv.children]
      .filter(c => c.classList.contains("active"))
      .map(c => c.textContent);
  };
  tagDiv.appendChild(s);
});

map.on('click', e => {
  if (currentMarker) map.removeLayer(currentMarker);
  currentMarker = L.marker(e.latlng, { icon: pinIcon(1) }).addTo(map);
});

function pinIcon(rating) {
  let color = `rgba(255,0,0,${rating / 5})`;
  if (rating === 5) {
    color = "linear-gradient(45deg, red, orange, yellow, green, blue, purple)";
  }

  return L.divIcon({
    className: '',
    html: `
      <div style="
        width: 24px;
        height: 24px;
        background:${color};
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border:1px solid #333;
      "></div>`
  });
}

function savePin() {
  if (!currentMarker) return;
  const data = {
    latlng: currentMarker.getLatLng(),
    name: placeName.value,
    rating: selectedRating,
    tags: selectedTags,
    comment: comment.value
  };
  localStorage.setItem("travelPin", JSON.stringify(data));
  alert("ä¿å­˜ã—ã¾ã—ãŸ");
}

function deletePin() {
  localStorage.removeItem("travelPin");
  if (currentMarker) map.removeLayer(currentMarker);
  currentMarker = null;
}

window.onload = () => {
  const data = JSON.parse(localStorage.getItem("travelPin"));
  if (!data) return;
  currentMarker = L.marker(data.latlng, {
    icon: pinIcon(data.rating)
  }).addTo(map);
  placeName.value = data.name;
  comment.value = data.comment;
};
</script>

</body>
</html>
