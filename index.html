<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>旅行ログ</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.container {
  height: 100%;
  display: flex;
  flex-direction: column;
}

#map {
  flex: 7;
}

.panel {
  flex: 3;
  padding: 10px;
  border-top: 1px solid #ddd;
  background: #fff;
  font-size: 15px;
}

.panel h2 {
  font-size: 16px;
  margin: 0 0 8px;
}

.photos {
  display: flex;
  gap: 6px;
  overflow-x: auto;
  margin: 6px 0;
}

.photos img {
  height: 80px;
  border-radius: 6px;
}

button {
  font-size: 15px;
  padding: 6px 10px;
  margin-right: 6px;
}
</style>
</head>

<body>
<div class="container">
  <div id="map"></div>

  <div class="panel" id="panel">
    <h2>使い方</h2>
    地図をタップするとピンを追加できます
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map("map", {
  center: [36, 138],
  zoom: 5,
  minZoom: 4,
  maxZoom: 18
});

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "© OpenStreetMap"
}).addTo(map);

const panel = document.getElementById("panel");

// 青・赤ピン
const blueIcon = new L.Icon({
  iconUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",
  shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
  iconSize: [25,41],
  iconAnchor: [12,41]
});

const redIcon = new L.Icon({
  iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
  shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
  iconSize: [25,41],
  iconAnchor: [12,41]
});

map.on("click", e => {
  const marker = L.marker(e.latlng, { icon: blueIcon }).addTo(map);
  openEditor(marker);
});

function openEditor(marker) {
  panel.innerHTML = `
    <h2>場所メモ</h2>
    <textarea id="comment" rows="2" style="width:100%" placeholder="コメント"></textarea>
    <input type="file" id="photos" accept="image/*" multiple>
    <div class="photos" id="photoList"></div>
    <br>
    <button id="done">行った！</button>
    <button id="delete">削除</button>
  `;

  const photoInput = document.getElementById("photos");
  const photoList = document.getElementById("photoList");

  photoInput.onchange = () => {
    photoList.innerHTML = "";
    [...photoInput.files].slice(0,5).forEach(file => {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      photoList.appendChild(img);
    });
  };

  document.getElementById("done").onclick = () => {
    marker.setIcon(redIcon);
    panel.innerHTML = "<h2>保存しました</h2>";
  };

  document.getElementById("delete").onclick = () => {
    map.removeLayer(marker);
    panel.innerHTML = "<h2>削除しました</h2>";
  };

  marker.on("click", () => openEditor(marker));
}
</script>
</body>
</html>
